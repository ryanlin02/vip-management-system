<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>貴賓管理系統</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 導航列 -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">貴賓管理系統</h1>
            <div class="nav-buttons">
                <button class="nav-btn" id="navGuestsBtn">貴賓</button>
                <button class="nav-btn" id="navSearchBtn">搜尋</button>
            </div>
        </div>
    </nav>

    <!-- 主要內容區 -->
    <main id="mainContent" class="main-content">
        <!-- 內容將由JavaScript動態載入 -->
    </main>

    <!-- 新增/編輯貴賓模態框 -->
    <div id="guestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">新增貴賓</h2>
                <button class="modal-close" id="modalCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="guestForm">
                    <div class="form-section">
                        <h3>基本資料（必填）</h3>
                        <div class="form-group">
                            <label for="lastName">姓氏 *</label>
                            <input type="text" id="lastName" required>
                        </div>
                        <div class="form-group">
                            <label for="firstName">名字 *</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="mainTitle">主要稱謂 *</label>
                            <input type="text" id="mainTitle" placeholder="例：市長、局長、處長" required>
                        </div>
                        <div class="form-group">
                            <label for="mainOrganization">主要單位 *</label>
                            <input type="text" id="mainOrganization" placeholder="例：嘉義市政府" required>
                        </div>
                        <div class="form-group">
                            <label for="gender">性別 *</label>
                            <select id="gender" required>
                                <option value="">請選擇</option>
                                <option value="male">男</option>
                                <option value="female">女</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>補充資料（非必填）</h3>
                        <div class="form-group">
                            <label for="photoURL">照片網址</label>
                            <input type="url" id="photoURL" placeholder="https://example.com/photo.jpg">
                        </div>
                        <div class="form-group">
                            <label for="otherTitles">其他頭銜</label>
                            <div class="tags-input-container">
                                <div id="tagsDisplay" class="tags-display"></div>
                                <input type="text" id="otherTitlesInput" placeholder="輸入後按Enter新增">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="guestIntroduction">貴賓介紹</label>
                            <textarea id="guestIntroduction" rows="3" placeholder="貴賓背景、經歷等"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="introductionRecord">介紹紀錄</label>
                            <textarea id="introductionRecord" rows="3" placeholder="活動中如何介紹此貴賓的紀錄"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-cancel" id="formCancelBtn">取消</button>
                        <button type="submit" class="btn-submit">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 大量上傳模態框 -->
    <div id="bulkUploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>大量上傳貴賓資料</h2>
                <button class="modal-close" id="bulkUploadCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-instructions">
                    <p>支援CSV或JSON格式檔案上傳</p>
                    <div class="format-examples">
                        <details>
                            <summary>CSV格式範例</summary>
                            <pre>姓氏,名字,主要稱謂,主要單位,性別,其他頭銜,照片URL
黃,敏惠,市長,嘉義市政府,female,第10屆市長,https://example.com/photo.jpg</pre>
                        </details>
                        <details>
                            <summary>JSON格式範例</summary>
                            <pre>[
  {
    "lastName": "黃",
    "firstName": "敏惠",
    "mainTitle": "市長",
    "mainOrganization": "嘉義市政府",
    "gender": "female",
    "otherTitles": ["第10屆市長"],
    "photoURL": "https://example.com/photo.jpg"
  }
]</pre>
                        </details>
                    </div>
                </div>
                <div class="upload-area">
                    <input type="file" id="bulkUploadFile" accept=".csv,.json" style="display: none;">
                    <button class="btn-upload" id="selectFileBtn">選擇檔案</button>
                    <p id="selectedFileName" class="selected-file"></p>
                </div>
                <div class="upload-actions">
                    <button type="button" class="btn-cancel" id="bulkUploadCancelBtn">取消</button>
                    <button type="button" class="btn-submit" id="bulkUploadSubmitBtn" disabled>開始上傳</button>
                </div>
                <div id="uploadProgress" class="upload-progress" style="display: none;">
                    <div class="progress-bar">
                        <div id="progressBarFill" class="progress-fill"></div>
                    </div>
                    <p id="progressText">上傳中...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 刪除確認模態框 -->
    <div id="deleteModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>確認刪除</h2>
            </div>
            <div class="modal-body">
                <p class="warning-text">此操作無法復原，確定要刪除嗎？</p>
                <p id="deleteTargetInfo"></p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" id="deleteModalCancelBtn">取消</button>
                <button type="button" class="btn-delete" id="deleteModalConfirmBtn">確定刪除</button>
            </div>
        </div>
    </div>

    <!-- Loading 提示 -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>載入中...</p>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, updateDoc, deleteDoc, query, orderBy, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // 將 Firebase 相關功能設為全域變數，供其他 JS 檔案使用
        window.firebaseApp = null;
        window.db = null;
        window.firestoreModule = { collection, addDoc, getDocs, getDoc, doc, updateDoc, deleteDoc, query, orderBy, where };

        // Firebase 配置將在 firebase-config.js 中設定
    </script>
    <script src="js/firebase-config.js"></script>
    <script src="js/guest-crud.js"></script>
    <script src="js/search.js"></script>
    <script src="js/bulk-upload.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
